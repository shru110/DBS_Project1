{% extends "layout.html" %}

{% block title %}{{ project.summary.title }} - Project Details{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">{{ project.summary.title }}</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <!-- Add an Edit Button -->
            <a href="{{ url_for('edit_project', project_id=project.summary.project_id) }}" class="btn btn-sm btn-outline-warning">Edit Project</a>
        </div>
    </div>
</div>

<!-- Project Summary Card -->
<div class="card mb-4">
    <div class="card-header">
        <h5>Project Summary</h5>
    </div>
    <div class="card-body">
        <p><strong>Client:</strong> {{ project.summary.client_name }} ({{ project.summary.industry }})</p>
        <p><strong>Status:</strong> 
            {% if project.summary.status == 1 %}
                <span class="badge bg-success">Completed</span>
            {% else %}
                <span class="badge bg-warning text-dark">In Progress</span>
            {% endif %}
        </p>
        <p><strong>Start Date:</strong> {{ project.summary.start_date }}</p>
        <p><strong>Completion Date:</strong> {{ project.summary.completion_date or 'N/A' }}</p>
        <p><strong>Total Hours Logged:</strong> {{ project.summary.total_hours_spent or 'N/A' }}</p>
        <hr>
        <p><strong>Description:</strong></p>
        <p>{{ project.summary.description }}</p>
    </div>
</div>

<div class="row">
    <!-- Assets Card -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5>Assets</h5>
            </div>
            <div class="card-body">
                {% if project.assets %}
                <ul class="list-group list-group-flush">
                    {% for asset in project.assets %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-file-earmark"></i> {{ asset.file_name }} ({{ asset.file_type|upper }})
                        </div>
                        <small class="text-muted">{{ asset.date_uploaded }}</small>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted">No assets have been uploaded for this project.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Feedback Card -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5>Feedback</h5>
            </div>
            <div class="card-body">
                {% if project.feedback %}
                    {% for item in project.feedback %}
                    <div class="border-bottom pb-2 mb-3">
                        <strong>{{ item.Reviewer_Name }}</strong> gave a rating of 
                        <span class="badge bg-primary">{{ item.rating }}</span>
                        <p class="mt-2 mb-1">{{ item.coment }}</p>
                        <small class="text-muted">{{ item.date }}</small>
                    </div>
                    {% endfor %}
                {% else %}
                <p class="text-muted">No feedback has been submitted for this project.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Team & Skills Card -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5>Team & Skills</h5>
            </div>
            <div class="card-body">
                <h6>Team Members</h6>
                <ul>
                    {% for member in project.team %}
                    <li>{{ member.name }} - <small class="text-muted">{{ member.role }}</small></li>
                    {% endfor %}
                </ul>
                <h6>Skills Used</h6>
                {% for skill in project.skills %}
                <span class="badge bg-secondary me-1">{{ skill.skill_name }} ({{ skill.skill_proficiency_rating }}/5)</span>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Time Logged Card -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5>Time Logged by Team</h5>
            </div>
            <div class="card-body">
                {% if project.team_hours %}
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Team Member</th>
                            <th>Hours</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for log in project.team_hours %}
                        <tr>
                            <td>{{ log.Team_Member }}</td>
                            <td>{{ log.Total_Hours_Logged }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="text-muted">No time has been logged for this project.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Tags -->
<div class="card mb-4">
    <div class="card-header">
        <h5>Project Tags</h5>
    </div>
    <div class="card-body">
        {% if project.tags %}
            {% for tag in project.tags %}
            <span class="badge bg-info text-dark me-1">{{ tag.tag_name }}</span>
            {% endfor %}
        {% else %}
        <p class="text-muted">No tags have been assigned to this project.</p>
        {% endif %}
    </div>
</div>

{% endblock %}